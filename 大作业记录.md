* 医生相关
  * 科室
  * 门诊坐诊
  * 住院部巡诊
    * 开诊疗方案
    * 治疗
    * 诊疗方案存档(插入住院记录)
  * 开处方--药品库存问题
    * 症状描述
    * 用药清单
  * 职称--诊疗费

* 病人
  * 初诊/复诊
    * 选择医生
  * 挂号--诊室
  * 根据处方缴费
  * 药房取药
  * 决定住院
    * 办理住院手续同时缴费(诊疗方案、病房床位费等)，建立住院档案，一对一
    * 安排病床--（科室-病房-病床）一对一
    * 主治医生一对多
* 药房管理人员
  * 查询库存情况
* 病房
  * 多个床位
  * 多个病人

# 系统需求分析

## 需求概述和系统边界

支持三种用户，医生、病人和系统管理员

## 主要业务处理流程

主要业务包括门诊治疗、住院治疗、药品信息。

**主要业务流程图**

## 功能需求分析

主要功能需求分析如下(课本版)。

1. 用户管理。医生和病人基本信息录入，维护与查询功能
   * 医生信息
   * 病人信息
2. 治疗管理
3. 药品管理
   * 药品基本信息
   * 药品库存(价格、数量、用法)
4. 看病管理
   * 挂号
   * 就诊记录
   * 查询记录
5. 住院管理
6. 科室管理
   * 科室基本信息
   * 排班情况
7. 缴费管理
   * 缴费
   * 查询费用明细

医疗系统的主要功能可以按照模块进行分类：

1.基础信息维护模块：
- 医院基本信息维护
- 科室基本信息维护
- 医生基本信息维护
- 药品基本信息维护

2.医生工作模块：

- 排班管理
- 病人接诊
- 处方管理

3.病人服务模块：

- 挂号管理
- 缴费管理
- 就诊管理
- 查看就诊记录
- 查看费用明细

4.数据统计模块：

- 科室排班情况统计
- 医生工作量统计
- 病人治疗情况统计

5.系统管理模块：
- 用户管理
- 权限管理
- 系统设置

## 数据需求分析

1. 医生信息：包括工号、登录密码、姓名、性别、职称、电话号码、科室

2. 病人信息：包括病案号、姓名、性别、地址、电话号码、病房编号，床位号

3. 住院档案(档案号，病案号、入院时间、出院时间、病房编号、床位号)

4. 药品信息：包括药品编号、药品名、单价、数量、用法

5. 科室信息：包括科室信息，**病房信息**

6. 病房信息：编号、地点、收费标准，所属科室

7. 病床信息：包括病房编号、床位号

8. 就诊记录：包括就诊单号(挂号得到，时间顺序)、就诊时间、**病人信息**、医生工号、总金额、住院情况、<u>治疗明细(处方、住院记录)</u>

9. <u>缴费记录：缴费单号、就诊单号、总金额</u>

   


# 数据库概念设计

科室属性较少，所以我们不将科室作为一个单独的实体集，而将科室作为医生的一个属性。



### 基本实体集及其属性：

**医生**(Doctor)实体集。其属性有：工号(docNo)、登录密码(docPassword)、姓名(docName)、性别(sex)、职称(degree)、电话号码(telephone)、科室号(officeNo)

| 属性名      | 含义     | 类别 | 域及约束                                                     | 实例        |
| ----------- | -------- | ---- | ------------------------------------------------------------ | ----------- |
| docNo       | 工号     | 主码 | char(10)，不允许取空值；由大写字母D加9位数字组成，前四位数字表示入职年份，后两份数字表示入职月份，后三位数值按入职的时间顺序递增表示。 | D202301001  |
| docPassword | 登录密码 |      | char(20)，不能少于6位；不能为空                              | 123456      |
| docName     | 姓名     |      | varchar(10)，不允许取空值                                    | 李梅        |
| sex         | 性别     |      | char(2)，取值范围：{'男'，'女'}                              | 男          |
| degree      | 职称     |      | varchar(20)                                                  | 主治医师    |
| telephone   | 电话号码 |      | char(11)，由数字字符组成                                     | 13049585932 |
| officeNo    | 科室号   |      | varchar(3)                                                   | 101         |



**病人**（Patient）实体集。其属性有密码（patPassword）、病案号（caseNumber）、姓名（patName）、性别（sex）、地址（address）、电话号码（telephone）

数据字典：

| 属性名      | 含义     | 类别 | 域及约束                                                     | 实例                                   |
| ----------- | -------- | ---- | ------------------------------------------------------------ | -------------------------------------- |
| patPassword | 密码     |      | char(20)，不能少于6位；不可以取空值；默认为123456            | P000000001                             |
| **patNo**   | 病案号   | 主码 | char(13)，由大写字母P加上12位数字组成，其中数字为入院年份、月份、日，后按当日入院时间顺序记录病人四位编号 | P202305210001                          |
| patName     | 姓名     |      | varchar(10)，不允许取空值                                    | 杨开放                                 |
| sex         | 性别     |      | char(2)，取值范围：{‘男’，‘女’}                              | 男                                     |
| telephone   | 电话号码 |      | char(11)，由数字字符组成                                     | 13966491259                            |
| address     | 地址     |      | varchar(100)，不允许取空值                                   | 广东省佛山市南海区华南师范大学南海校园 |



**药品**(Medicine)实体集合。其属性有：药品编号(medicineNo)、药品名(medName)、单价(price)、库存数量(medLeft)、用法(usage)

| 属性名     | 含义     | 类别 | 域及约束                                                     | 实例                                                         |
| ---------- | -------- | ---- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| medicineNo | 药品编号 | 主码 | char(10)，不允许取空值；又两位字母加6位数字组成，两位字母统一为YP表示“药品”，接着四位字母表示药品转正年份，最后两位数字为转正号 | YP202301                                                     |
| medName    | 药品名   |      | varchar(30)，不允许取空值                                    | 阿莫西林胶囊                                                 |
| price      | 单价     |      | numeric                                                      | 30                                                           |
| medLeft    | 库存数量 |      | int                                                          | 200                                                          |
| usage      | 用法     |      | varchar(100)                                                 | 口服。成人一次0.5g，每6～8小时1次，一日剂量不超过4g。小儿一日剂量按体重20～40mg/Kg，每8小时1次; |



**处方**(Recipet)实体集合。其属性有有：处方单号(recipeNo)、症状描述(symptom)、诊疗费(money)、工号(docNo)、病案号(patNo)

| 属性名称            | 含义     | 类别 | 域及约束                                                     | 实例          |
| ------------------- | -------- | ---- | ------------------------------------------------------------ | ------------- |
| **<u>recipeNo</u>** | 处方单号 | 主码 | char(7)，三位字母加四位数字组成，三位字母统一为"RCP"表示处方，后四位表示单号序列 | RCP0001       |
| symptom             | 症状描述 |      | varchar(100)                                                 | 头痛、发热    |
| money               | 诊疗费   |      | numeric                                                      | 50.00         |
| docNo               | 工号     |      | char(10)                                                     | D202301001    |
| patNo               | 病案号   |      | char(13)                                                     | P202305210001 |

**住院档案**（DepartDocument）实体集。其属性有：档案号（departNo），病案号（patientNo），入院时间（indepartDate），出院时间（outdepartDate），病房编号（wardNo），病床编号（bedNo）。

| 属性名        | 含义     | 类别   | 域及约束               | 实例          |
| ------------- | -------- | ------ | ---------------------- | ------------- |
| departNo      | 档案号   | 主码   | char(8)，不允许取空值  | 10000001      |
| patNo         | 病案号   |        | char(13)，不允许取空值 | P202105120001 |
| indepartDate  | 入院时间 |        | date，不允许取空值     | 2021-05-12    |
| outdepartDate | 出院时间 |        | date，可以取空值       | 2021-05-12    |
| wardNo        | 病房编号 |        | char(4)，不允许取空值  | A001          |
| bedNo         | 病床编号 | 部分码 | char(3)，不允许取空值  | 001           |

**缴费单**（Payment）实体集。其属性有：流水号（paymentNo），病案号（patNo），金额（fee），缴费状态（paymentState），缴费日期（paymentDate）。

| 属性名       | 含义     | 类别 | 域及约束                                | 实例             |
| ------------ | -------- | ---- | --------------------------------------- | ---------------- |
| paymentNo    | 流水号   | 主码 | char(16)，不允许取空值                  | PY20210512000001 |
| patNo        | 病案号   |      | char(13)，不允许取空值                  | P202105120001    |
| Fee          | 金额     |      | float，不允许取空值                     | 50.00            |
| paymentState | 缴费状态 |      | char(6)，仅可从“已缴费”、“未缴费”中选择 | 已缴费           |
| paymentDate  | 缴费日期 |      | date                                    | 2021-05-12       |

**病房**（Ward）实体集。其属性有：病房编号（wardNo），地点（address），收费标准（chargeStand），科室号（officeNo）。

| 属性名      | 含义     | 类别 | 域及约束                  | 实例    |
| ----------- | -------- | ---- | ------------------------- | ------- |
| wardNo      | 病房编号 | 主码 | char(4)，不允许取空值     | A001    |
| address     | 地点     |      | varchar(10)，不允许取空值 | 一楼A区 |
| chargeStand | 收费标准 |      | INT，不允许取空值         | 100     |
| officeNo    | 科室号   |      | varchar(3)，不允许取空值  | 502     |

**收费标准**（Charge）实体集。其属性有：职称（degree），价格（price）。

| 属性名 | 含义 | 类别 | 域及约束              | 实例     |
| ------ | ---- | ---- | --------------------- | -------- |
| degree | 职称 | 主码 | varchar(20)           | 主治医师 |
| price  | 价格 |      | numeric，不允许取空值 | 30       |

**医疗方案**（AidPlan）实体集。其属性有：方案编号（planNo），方案描述（description），收费标准（money）.

| 属性名称          | 含义     | 类别 | 域及约束                          | 实例           |
| ----------------- | -------- | ---- | --------------------------------- | -------------- |
| **<u>planNo</u>** | 方案编号 | 主码 | char(5)，第一位为分类，其余为序号 | 20001          |
| description       | 方案描述 |      | varchar(100)                      | 病人长时间高烧 |
| money             | 收费标准 |      | float                             | 50.00          |

### 弱实体集及其属性：

**住院记录**（DepartRecord）弱实体集。其属性有：档案号（departNo），记录号（aidNo），治疗方案（aidPlan），病人状况（patSymptom）。

| 属性名     | 含义     | 类别 | 域及约束                                                    | 实例     |
| ---------- | -------- | ---- | ----------------------------------------------------------- | -------- |
| departNo   | 档案号   |      | char(8)，不允许取空值                                       | 10000001 |
| aidNo      | 记录号   | 派生 | int(3)，从001开始，由入院日期至当日日期差计算，不允许取空值 | 001      |
| aidPlan    | 治疗方案 |      | char(5)                                                     | 10001    |
| patSymptom | 病人状况 |      | varchar(100)                                                | 良好     |

**病床**（Bed）弱实体集。其属性有：病床编号（bedNo），病房编号（wardNo），病床状态（bedState）。

| 属性名   | 含义     | 类别   | 域及约束                            | 实例 |
| -------- | -------- | ------ | ----------------------------------- | ---- |
| bedNo    | 病床编号 | 部分码 | char(3)，不允许取空值               | 001  |
| wardNo   | 病房编号 |        | char(4)，不允许取空值               | A101 |
| bedState | 病床状态 |        | char(4)，仅可从“有人”，“空闲”中选择 | 有人 |

### 联系集及其属性：



## 主要业务局部概念建模 



# 数据库逻辑设计

* 医生(工号、登录密码、姓名、性别、职称、电话号码、科室号)
* 病人(病案号、登录密码、姓名、性别、地址、电话号码)
* 处方(处方单号、症状描述、诊疗费、工号、病案号)
* 用药清单(药品编号、药品名、用法、用药数量、一种药的价格)
* 药品(药品编号、药品名、单价、数量、用法)
* 挂号单(就诊单号、挂号时间、病案号、工号)
* 时间安排(工号、科室号、值班时间、诊室号)



医生(Doctor)表：由**医生**(Doctor)实体集转化而来。

| 属性名称            | 数据类型    | 属性描述 |
| ------------------- | ----------- | -------- |
| **<u>doctorNo</u>** | char(10)    | 工号     |
| docPassword         | char(20)    | 登录密码 |
| docName             | varchar(10) | 姓名     |
| sex                 | char(2)     | 性别     |
| degree              | varchar(20) | 职称     |
| telephone           | char(11)    | 电话号码 |
| officeNo            | varchar(3)  | 科室号   |



病人(Patient)表：由**病人**(Patient)实体集转化而来。

| 属性名称         | 数据类型     | 属性描述 |
| ---------------- | ------------ | -------- |
| **<u>patNo</u>** | char(13)     | 病案号   |
| patPassword      | char(20)     | 登录密码 |
| patName          | varchar(10)  | 姓名     |
| sex              | char(2)      | 性别     |
| telephone        | char(11)     | 电话号码 |
| address          | varchar(100) | 地址     |



处方(Recipe)表：由❓**处方**(Recipe)实体集以及开具(Issure)、缴费(Bill)联系集转化而来。

| 属性名称            | 数据类型     | 属性描述 |
| ------------------- | ------------ | -------- |
| **<u>recipeNo</u>** | char(7)      | 处方单号 |
| symptom             | varchar(100) | 症状描述 |
| money               | numeric      | 诊疗费   |
| **docNo**           | char(10)     | 工号     |
| **patNo**           | char(13)     | 病案号   |



药品(Medicine)表：由**药品**(Medicine)实体集转化而来。

| 属性名称              | 数据类型     | 属性描述 |
| --------------------- | ------------ | -------- |
| **<u>medicineNo</u>** | char(10)     | 药品编号 |
| medName               | varchar(30)  | 药品名   |
| price                 | numeric      | 单价     |
| medLeft               | int          | 库存数量 |
| usage                 | varchar(100) | 用法     |



用药清单(MedicationList)表：由❓**用药清单**(MedicationList)弱实体集和包含(Contain)、购药(BuyMedicine)联系集转化而来。

| 属性名称       | 数据类型    | 属性描述 |
| -------------- | ----------- | -------- |
| **recipeNo**   | char(7)     | 处方单号 |
| **medicineNo** | varchar(10) | 药品编号 |
| medQuantity    | int         | 用药数量 |



❓挂号单(BookingForm)表：由**挂号单**(BookingForm)实体集和拥有(Own)、排时间(ShiftTime)联系集转化而来。

| 属性名称             | 数据类型 | 属性描述 |
| -------------------- | -------- | -------- |
| **<u>bookingNo</u>** | char(13) | 就诊单号 |
| bookingTime          | datetime | 挂号时间 |
| **docNo**            | char(10) | 工号     |
| **patNo**            | char(13) | 病案号   |



❓时间安排(Schedule)表：由**时间安排**(Schedule)弱实体集和排班(Shift)、排诊室(ShiftRoom)、排时间(ShiftTime)联系集转化而来。

| 属性名称     | 数据类型   | 属性描述 |
| ------------ | ---------- | -------- |
| **docNo**    | char(10)   | 工号     |
| **officeNo** | varchar(3) | 科室号   |
| dutyDate     | date       | 值班日期 |
| dutyShift    | ENUM       | 值班班次 |
| **RoomNo**   | varchar(4) | 诊室号   |

**住院档案**（DepartDocument）表由**住院档案**（DepartDocument）实体集转化而来。

| 属性名              | 数据类型 | 属性描述 |
| ------------------- | -------- | -------- |
| **<u>departNo</u>** | char(8)  | 档案号   |
| patNo               | char(16) | 病案号   |
| indepartDate        | date     | 入院时间 |
| outdepartDate       | date     | 出院时间 |
| bedNo               | char(3)  | 病床编号 |
| wardNo              | char(4)  | 病房编号 |

**住院记录**（DepartRecord）表由**住院记录**（DepartRecord）弱实体集转化而来。

| 属性名     | 数据类型     | 属性描述 |
| ---------- | ------------ | -------- |
| departNo   | char(8)      | 档案号   |
| aidNo      | int(3)       | 记录号   |
| aidPlan    | char(5)      | 治疗方案 |
| patSymptom | varchar(100) | 病人状况 |

**缴费单**（Payment）表由**缴费单**（Payment）实体集转化而来。

| 属性名       | 数据类型 | 属性描述 |
| ------------ | -------- | -------- |
| paymentNo    | char(16) | 流水号   |
| patNo        | char(13) | 病案号   |
| Fee          | float    | 金额     |
| paymentState | char(6)  | 缴费状态 |
| paymentDate  | date     | 缴费日期 |

**病房**（Ward）表由**病房**（Ward）实体集转化而来。

| 属性名            | 数据类型    | 属性描述 |
| ----------------- | ----------- | -------- |
| **<u>wardNo</u>** | char(4)     | 病房编号 |
| address           | varchar(10) | 地点     |
| chargeStand       | INT         | 收费标准 |
| officeNo          | varchar(3)  | 科室号   |

**病床**（Bed）表由**病床**（Bed）实体集转化而来。

| 属性名           | 数据类型 | 属性描述 |
| ---------------- | -------- | -------- |
| **<u>bedNo</u>** | char(3)  | 病床编号 |
| wardNo           | char(4)  | 病房编号 |
| bedState         | char(4)  | 病床状态 |

**收费标准**（Charge）表由**收费标准**（Charge）实体集转化而来。

| 属性名            | 数据类型    | 属性描述 |
| ----------------- | ----------- | -------- |
| **<u>degree</u>** | varchar(20) | 职称     |
| price             | numeric     | 价格     |

**医疗方案**（AidPlan）表由**医疗方案**（AidPlan）实体集转化而来。

| 属性名称          | 数据类型     | 属性描述 |
| ----------------- | ------------ | -------- |
| **<u>planNo</u>** | char(5)      | 方案编号 |
| description       | varchar(100) | 方案描述 |
| money             | float        | 收费标准 |
